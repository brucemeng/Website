---
title: Two Methods for Animations in R
author: Bruce Meng
date: '2018-03-18'
slug: animations-in-r
categories: []
tags:
  - R
---

```{r setup, include=F}
library(tidyverse)
library(plotly)
library(knitr)
library(kableExtra)

```

When I was in school, I always found that the blackboard was the best teaching tool (as opposed to say a pre-prepared static slide in PowerPoint). As a student, I found it really helpful to see a concept get built up from nothing, and accordingly when I was a teaching assistant in economics, I also preferred using the blackboard to build up concepts together with my students (I also found it more fun as it was now a collaborative experience). Now in the business world, developing concepts is still as important as when I was in school, but using a blackboard will likely get me... looks... luckily, there's a very neat alternative: the animation!

I've been trying two methods with animations:

1. `gganimate` & `tweenr`
2. `plotly`

Let's build a quick demo of each!

# Dataset

This post will be more on creating animations, rather than focus on the specific dataset being animated. Having said that, an interesting dataset will make this all the more exciting. 

Gapminder has put together a series of data about the world across time and has made the video that has been described as ['The best stats you've ever seen'](https://www.ted.com/talks/hans_rosling_shows_the_best_stats_you_ve_ever_seen). I certainly agree.

We shall look at how income per person has been affecting the number of children women have given birth to throughout the years.

## Pulling in the data

We'll begin with downloading the data. 

[Link to Gapminder income data](https://docs.google.com/spreadsheet/pub?key=phAwcNAVuyj1jiMAkmq1iMg&output=xlsx)

[Link to Gapminder babies data](https://docs.google.com/spreadsheet/pub?key=phAwcNAVuyj0TAlJeCEzcGQ&output=xlsx)

[Link to Gapminder population data](https://docs.google.com/spreadsheet/pub?key=phAwcNAVuyj0XOoBL_n5tAQ&output=xlsx)

```{r data}
library(readxl)

data.income <- read_excel("../../data/gapminder/indicator gapminder gdp_per_capita_ppp.xlsx")
data.babies <- read_excel("../../data/gapminder/indicator undata total_fertility.xlsx")
data.pop <- read_excel("../../data/gapminder/indicator gapminder population.xlsx")
```

I'm going to do some data cleanup but I will skip the code to keep this post more brief.

[...data cleanup...]

```{r data.clean, echo = F, message = F}
## Income
# Wide to long data conversion
names(data.income)[1] <- "country"
data.income %>%
        gather(year, income, `1800.0`:`2015.0`) -> data.income.clean

# Convert year to numeric
data.income.clean$year <- as.numeric(data.income.clean$year)
        
## Babies
# Wide to long data conversion
names(data.babies)[1] <- "country"
data.babies %>%
        gather(year, babies, `1800.0`:`2015.0`) -> data.babies.clean

# Convert year to numeric
data.babies.clean$year <- as.numeric(data.babies.clean$year)

## Population
# Wide to long data conversion
names(data.pop)[1] <- "country"
data.pop %>%
        gather(year, pop, `1800.0`:`2015.0`) -> data.pop.clean

# Convert year to numeric
data.pop.clean$year <- as.numeric(data.pop.clean$year)

## Get region data
data.region <- gapminder::gapminder %>%
        select(country, continent)
```

After the data cleanup, we will join all the datasets together for one unified set:

```{r data.join}
# Join datasets
data.join <- left_join(data.income.clean, data.babies.clean) %>%
        left_join(data.pop.clean) %>%
        left_join(data.region)
```


Here's what the first 20 data points look like:

```{r data.present, echo = F}
head(data.join, 20) %>%
        kable("html") %>%
                kable_styling(c("striped", "hover"),
                              font_size = 10)

```

# `gganimate` with `tweenr`

First up, is a solution that's fully self-contained within the ggplot2 universe: the package `gganimate` developed by David Robinson.

```{r gganimate, fig.show="animate"}
library(gganimate)

# Plot
p <- ggplot(data.join) +
        geom_point(aes(x = income, y = babies, size = pop, frame = year, colour = continent))

# Animate Plot
gganimate(p)

```



