---
title: Two Methods for Animations in R
author: Bruce Meng
date: '2018-03-18'
slug: animations-in-r
categories: []
tags:
  - R
---



<p>When I was in school, I always found that the blackboard was the best teaching tool (as opposed to say a pre-prepared static slide in PowerPoint). As a student, I found it really helpful to see a concept get built up from nothing, and accordingly when I was a teaching assistant in economics, I also preferred using the blackboard to build up concepts together with my students (I also found it more fun as it was now a collaborative experience). Now in the business world, developing concepts is still as important as when I was in school, but using a blackboard will likely get me… looks… luckily, there’s a very neat alternative: the animation!</p>
<p>I’ve been trying two methods with animations:</p>
<ol style="list-style-type: decimal">
<li><code>gganimate</code> &amp; <code>tweenr</code></li>
<li><code>plotly</code></li>
</ol>
<p>Let’s build a quick demo of each!</p>
<div id="dataset" class="section level1">
<h1>Dataset</h1>
<p>This post will be more on creating animations, rather than focus on the specific dataset being animated. Having said that, an interesting dataset will make this all the more exciting.</p>
<p>Gapminder has put together a series of data about the world across time and has made the video that has been described as <a href="https://www.ted.com/talks/hans_rosling_shows_the_best_stats_you_ve_ever_seen">‘The best stats you’ve ever seen’</a>. I certainly agree.</p>
<p>We shall look at how income per person has been affecting the number of children women have given birth to throughout the years.</p>
<div id="pulling-in-the-data" class="section level2">
<h2>Pulling in the data</h2>
<p>We’ll begin with downloading the data.</p>
<ol style="list-style-type: decimal">
<li><p><a href="https://docs.google.com/spreadsheet/pub?key=phAwcNAVuyj1jiMAkmq1iMg&amp;output=xlsx">Link to Gapminder income data</a></p></li>
<li><p><a href="https://docs.google.com/spreadsheet/pub?key=phAwcNAVuyj0TAlJeCEzcGQ&amp;output=xlsx">Link to Gapminder babies data</a></p></li>
<li><p><a href="https://docs.google.com/spreadsheet/pub?key=phAwcNAVuyj0XOoBL_n5tAQ&amp;output=xlsx">Link to Gapminder population data</a></p></li>
</ol>
<pre><code>## Warning in rbind(names(probs), probs_f): number of columns of result is not
## a multiple of vector length (arg 1)</code></pre>
<pre><code>## Warning: 14 parsing failures.
## row # A tibble: 5 x 5 col     row col        expected               actual   file                    expected   &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;                  &lt;chr&gt;    &lt;chr&gt;                   actual 1  5203 population no trailing characters .5234195 &#39;../../data/gapminder/~ file 2  5204 population no trailing characters .5814796 &#39;../../data/gapminder/~ row 3  5205 population no trailing characters .6773771 &#39;../../data/gapminder/~ col 4  5206 population no trailing characters .1421408 &#39;../../data/gapminder/~ expected 5  5207 population no trailing characters .3403884 &#39;../../data/gapminder/~
## ... ................. ... .......................................................................... ........ .......................................................................... ...... .......................................................................... .... .......................................................................... ... .......................................................................... ... .......................................................................... ........ ..........................................................................
## See problems(...) for more details.</code></pre>
<p>I’m going to do some data cleanup but I will skip the code to keep this post more brief.</p>
<p>[…data cleanup…]</p>
<p>After the data cleanup, we will join all the datasets together for one unified set:</p>
<pre class="r"><code># Join datasets
data.join &lt;- left_join(data.income.clean, data.babies.clean) %&gt;%
        left_join(data.pop.clean) %&gt;%
        left_join(data.region.clean)

data.join[complete.cases(data.join),] -&gt; data.join</code></pre>
<p>Here’s what the first 20 data points look like:</p>
<table class="table table-striped table-hover" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
income
</th>
<th style="text-align:right;">
babies
</th>
<th style="text-align:right;">
pop
</th>
<th style="text-align:left;">
region
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
603
</td>
<td style="text-align:right;">
7.00
</td>
<td style="text-align:right;">
3280000
</td>
<td style="text-align:left;">
South Asia
</td>
</tr>
<tr>
<td style="text-align:left;">
Albania
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
667
</td>
<td style="text-align:right;">
4.60
</td>
<td style="text-align:right;">
410445
</td>
<td style="text-align:left;">
Europe &amp; Central Asia
</td>
</tr>
<tr>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
716
</td>
<td style="text-align:right;">
6.99
</td>
<td style="text-align:right;">
2503218
</td>
<td style="text-align:left;">
Middle East &amp; North Africa
</td>
</tr>
<tr>
<td style="text-align:left;">
Angola
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
618
</td>
<td style="text-align:right;">
6.93
</td>
<td style="text-align:right;">
1567028
</td>
<td style="text-align:left;">
Sub-Saharan Africa
</td>
</tr>
<tr>
<td style="text-align:left;">
Antigua and Barbuda
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
757
</td>
<td style="text-align:right;">
5.00
</td>
<td style="text-align:right;">
37000
</td>
<td style="text-align:left;">
Latin America &amp; Caribbean
</td>
</tr>
<tr>
<td style="text-align:left;">
Argentina
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
1507
</td>
<td style="text-align:right;">
6.80
</td>
<td style="text-align:right;">
534000
</td>
<td style="text-align:left;">
Latin America &amp; Caribbean
</td>
</tr>
<tr>
<td style="text-align:left;">
Armenia
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
514
</td>
<td style="text-align:right;">
7.80
</td>
<td style="text-align:right;">
413326
</td>
<td style="text-align:left;">
Europe &amp; Central Asia
</td>
</tr>
<tr>
<td style="text-align:left;">
Aruba
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
833
</td>
<td style="text-align:right;">
5.64
</td>
<td style="text-align:right;">
19286
</td>
<td style="text-align:left;">
Latin America &amp; Caribbean
</td>
</tr>
<tr>
<td style="text-align:left;">
Australia
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
815
</td>
<td style="text-align:right;">
6.50
</td>
<td style="text-align:right;">
351014
</td>
<td style="text-align:left;">
East Asia &amp; Pacific
</td>
</tr>
<tr>
<td style="text-align:left;">
Austria
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
1848
</td>
<td style="text-align:right;">
5.10
</td>
<td style="text-align:right;">
3205587
</td>
<td style="text-align:left;">
Europe &amp; Central Asia
</td>
</tr>
<tr>
<td style="text-align:left;">
Azerbaijan
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
775
</td>
<td style="text-align:right;">
8.10
</td>
<td style="text-align:right;">
879960
</td>
<td style="text-align:left;">
Europe &amp; Central Asia
</td>
</tr>
<tr>
<td style="text-align:left;">
Bahrain
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
1235
</td>
<td style="text-align:right;">
7.03
</td>
<td style="text-align:right;">
64474
</td>
<td style="text-align:left;">
Middle East &amp; North Africa
</td>
</tr>
<tr>
<td style="text-align:left;">
Bangladesh
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
876
</td>
<td style="text-align:right;">
6.70
</td>
<td style="text-align:right;">
19227358
</td>
<td style="text-align:left;">
South Asia
</td>
</tr>
<tr>
<td style="text-align:left;">
Barbados
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
913
</td>
<td style="text-align:right;">
4.96
</td>
<td style="text-align:right;">
81729
</td>
<td style="text-align:left;">
Latin America &amp; Caribbean
</td>
</tr>
<tr>
<td style="text-align:left;">
Belarus
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
608
</td>
<td style="text-align:right;">
7.00
</td>
<td style="text-align:right;">
2355081
</td>
<td style="text-align:left;">
Europe &amp; Central Asia
</td>
</tr>
<tr>
<td style="text-align:left;">
Belgium
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
2412
</td>
<td style="text-align:right;">
4.85
</td>
<td style="text-align:right;">
3138137
</td>
<td style="text-align:left;">
Europe &amp; Central Asia
</td>
</tr>
<tr>
<td style="text-align:left;">
Belize
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
579
</td>
<td style="text-align:right;">
6.69
</td>
<td style="text-align:right;">
25526
</td>
<td style="text-align:left;">
Latin America &amp; Caribbean
</td>
</tr>
<tr>
<td style="text-align:left;">
Benin
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
597
</td>
<td style="text-align:right;">
5.55
</td>
<td style="text-align:right;">
636559
</td>
<td style="text-align:left;">
Sub-Saharan Africa
</td>
</tr>
<tr>
<td style="text-align:left;">
Bhutan
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
629
</td>
<td style="text-align:right;">
6.67
</td>
<td style="text-align:right;">
89989
</td>
<td style="text-align:left;">
South Asia
</td>
</tr>
<tr>
<td style="text-align:left;">
Bolivia
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
854
</td>
<td style="text-align:right;">
6.48
</td>
<td style="text-align:right;">
1100000
</td>
<td style="text-align:left;">
Latin America &amp; Caribbean
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="gganimate-with-tweenr" class="section level1">
<h1><code>gganimate</code> with <code>tweenr</code></h1>
<p>First up, is a solution that’s fully self-contained within the ggplot2 universe: the package <code>gganimate</code> developed by David Robinson.</p>
<pre class="r"><code>library(gganimate)
library(tweenr)

# Tween for smoother animations
data.join.tween &lt;- data.join %&gt;%
        rename(x = income,
               y = babies,
               time = year,
               id = country) %&gt;%
        mutate(ease = &quot;linear&quot;) %&gt;%
        select(-region) %&gt;%
        tween_elements(&quot;time&quot;, &quot;id&quot;, &quot;ease&quot;, nframes = 1000)

# Re-add prior data
data.join.tween &lt;- inner_join(data.join.tween, data.region.clean, by = c(&quot;.group&quot; = &quot;country&quot;)) 

# Plot
p &lt;- ggplot(data.join.tween, aes(x = x, y = y)) +
        geom_point(aes(size = pop, frame = .frame, colour = region), alpha = 0.7) +  
        xlab(&quot;GDP per capita&quot;) +
        ylab(&quot;Number of Babies Born per Woman&quot;) +
        theme_minimal(base_size = 12, base_family = &quot;Georgia&quot;) +
        geom_smooth(aes(group = .frame, frame = .frame), method = &quot;loess&quot;, 
                    color = &quot;black&quot;, linetype = &quot;dashed&quot;, se = F, size = 0.5) +
        theme(legend.position=&quot;none&quot;) +
        scale_x_continuous(labels = dollar) + 
        scale_size_area(guide = FALSE, max_size = 20) +
        scale_color_brewer(name = &quot;&quot;, palette = &quot;Set2&quot;) +
        facet_wrap(~region)


# Animate Plot
# gganimate(p, title_frame = T, interval = 0.02, &quot;../../static/img/gganimate.gif&quot;, ani.width = 1024, ani.height = 1024) #&lt;- Not run to save render time</code></pre>
<div class="figure">
<img src="/img/gganimate.gif" />

</div>
</div>
